---
title: "Team Project Multivariate Analysis"
author: "Adrian White, Cesar Conejo, Xavier Bryant"
date: "11/14/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.width=12, fig.height=6)

options(digits=4)

# Load data
load('rda/clinical_trial_complete.rda')

source("scripts/functions/graph_functions.R")

X <- clinical_trial_complete
color_1 <- "deepskyblue2"
color_2 <- "seagreen2"
color_3 <- "orange2"

#Libraries
library("andrews")
library(MASS)


# Remove the file
rm(clinical_trial_complete)
```

### Team members

* Adrian White: 1004391004
* Cesar Conejo: 100443596 (Representative member)
* Xavier Bryant: 100445659


### Introduction data set

We have selected the [CRASH-2](http://biostat.mc.vanderbilt.edu/wiki/pub/Main/DataSets/crash2.html) data set provided by Vanderbilt School of Biostatistics for our project. It describes the outcome of a randomized controlled trial and economic valuation of the effects of tranexamic acid on death, vascular occlusive events, and transfusion requirement in bleeding trauma patients. Tranexamic acid reduces bleeding in trauma patients undergoing surgery but is an expensive treatment option. The trial's objective was to assess the effects and cost-effectiveness of an early administration of this medication. 

Participants of the study were adults with, or at risk of, significant bleeding within 8 hours of injury. Sample randomization was determined by the allocation of an eight-digit sequence randomly generated by a computer. Patients and staff were masked to the treatment allocation of the tranexamic acid.

We have adjusted the original data set to remove some variables that were not relevant to our investigation. We have removed variables regarding the exact surgical procedures administered to patients, various IDs, and details on the patient outcome. We removed the health outcome columns because of complications regarding missing data, where the boolean structure of the columns relating to specific outcomes, like stroke or pulmonary embolism, left a large number of cases with missing values. Instead, we added a boolean variable for a general outcome of survival to assess the efficacy of the procedure, rather than looking at particular health outcomes in post-surgery for living patients. 

We will be using variables regarding the sex, age, and injury of the patient as well as certain biometrics, like blood pressure, respiratory and heart rates, details on surgical blood transfusion, and a boolean variable on the survival of the patient. Our selection provides us with a balance of continuous and categorical variables, many of which are boolean, with minimal complications due to missing data.
 

### Summary variables in the data set

The variables in this dataset are the following:

* entryid: (Numerical) Unique Numbers for Entry Forms

* sex: (Boolean) The sex of the patient (Male/Female)

* age : (Numerical) Age of the patient(Years)

* injurytime: (Numerical) Hours since injury (Hours)

* injurytype:	(Categorical) Type of injury {Blunt, Penetrating, Blunt and Penetrating}

* sbp: (Numerical) Systolic Blood Pressure (mmHg)

* rr: (Numerical) Respiratory Rate (rate per minute)

* cc: (Numerical) Central Capillary Refille Time (seconds)

* hr: (Numerical) Heart Rate (rate per minute)

* ndaysicu: (Numerical) Number of days in ICU (days)

* btransf: (Boolean) Blood Products Transfusion

* ncell: (Numerical) Number of Units of Red Call Products Transfused

* nplasma: (Numerical) Number of Units of Fresh Frozen Plasma Transfused

* nplatelets: (Numerical) Number of Units of Platelets Transfused

* ncryo: (Numerical) Number of Units of Cryoprecipitate Transfused

* bvii:	(Boolean) Recombinant Factor VIIa Given


* Death: (Boolean) Indicator if the patient survived after the procedure

* bloading: (Boolean)	Complete Loading Dose of Trial Drug Given

A summary of the data type is the following:

```{r echo=FALSE}
variable <- c("entryid","sex","age","injurytime","injurytype","sbp","rr","cc","hr","ndaysicu","btransf","ncell","nplasma","nplatelets","ncryo","bvii","death", "bloading")

type_variable <- c("Quantitative","Qualitative","Quantitative","Quantitative","Qualitative","Quantitative","Quantitative","Quantitative","Quantitative","Quantitative","Quanlitative","Quantitative","Quantitative","Quantitative","Quantitative","Qualitative","Qualitative","Qualitative")


sub_type_variable <- c("Continuous","Nominal","Continuous","Continuous","Nominal","Continuous","Continuous","Continuous","Continuous","Discrete","Nominal","Discrete","Discrete","Discrete","Discrete","Nominal","Nominal","Nominal")

summary.methods <- data.frame(variable,
                              type_variable,
                              sub_type_variable,
                              row.names = NULL)
knitr::kable(summary.methods)
```

\newpage

### Summary and Graphical display of individual variables

A review of the structure of the dataset is the following:

```{r echo=FALSE}
str(X)
```

A summary of the values in the data set are:

```{r echo=FALSE}
summary(X)
```

\newpage

Finally, the list of different values by column is the following:

```{r echo=FALSE}
apply(X, 2, function(x) length(unique(x)))
```

Some visualizations of the distributions of the quantitative variables are:

```{r echo=FALSE}
plothist(col_name = "age", df = X, ylabtext = "All participants",  color_1)
```

```{r echo=FALSE}
plothist(col_name = "injurytime", df = X, ylabtext = "All participants",  color_1)
```

```{r echo=FALSE}
plothist(col_name = "sbp", df = X, ylabtext = "All participants",  color_1)
```

```{r echo=FALSE}
plothist(col_name = "rr", df = X, ylabtext = "All participants",  color_1)
```

```{r echo=FALSE}
plothist(col_name = "hr", df = X, ylabtext = "All participants",  color_1)
```

```{r echo=FALSE}
plothist(col_name = "cc", df = X, ylabtext = "All participants",  color_1)
```

```{r echo=FALSE}
plothist(col_name = "ndaysicu", df = X, ylabtext = "All participants",  color_1)
```

```{r echo=FALSE}
plothist(col_name = "ncell", df = X, ylabtext = "All participants",  color_1)
```

```{r echo=FALSE}
plothist(col_name = "nplasma", df = X, ylabtext = "All participants",  color_1)
```

```{r echo=FALSE}
plothist(col_name = "nplatelets", df = X, ylabtext = "All participants",  color_1)
```

```{r echo=FALSE}
plothist(col_name = "ncryo", df = X, ylabtext = "All participants",  color_1)
```

### Discussion on the individual variable distributions

* **age:** Age appears to be largely weighted to the left, with lower ages featuring more frequently than those that are greater, possibly reflecting that younger people often take more risk and work higher at-risk occupations, raising their chance of experiencing trauma involving bleeding.

* **sex:** Sex is heavily weighed to males, similar to age, possibly demonstrating that men take more risk and work at higher risk occupations. increasing the likelihood of experiencing trauma that would involve large amounts of bleeding.

* **injurytime:** Injury time is weighted to the right, with almost all values falling below ten minutes since the injury was experienced. This is likely due to the fact that in cases of serious injury victims are brought to the hospital quite quickly.

* **injurytype:** Shows that the majority of patients have a blunt trauma, at 5211, then 2937 have a penetrating injury and 1349 with both.

* **sbp:** It seems that Sbp (Systolic Blood Pressure) is a fairly centrally balanced distribution around 90 mmHg. This is logical as a sample of biological characteristics observed in a population is likely to have most people around the mean and then a reasonably tight distribution of those who differ, similar to that of other biological features like height. Furthermore, most people are fairly young in the sample and therefore would have rates that deviant less from the norm, at a healthy level.

* **rr:** Respiratory rate appears, similar to sbp, resembling a moderately balanced distribution around 22 respirations per minute, although is weighted more to the right.

* **hr:** Heart rate also seems fairly balanced at around 110, similar to the variables above, like rr and sbp.

* **cc:** Central capillary refill has 75% of the observations below of 4. However, the distribution is right-skewed.

* **ndaysicu:** The distribution is heavily weighted to the left and right-skewed. Most patients it seems, with injuries at high risk of bleeding, do not often need to remain in the hospital for long.

* **ncell:** The distribution is weighted to the left with a median of 3, with many patients, only needing a small number of or zero units of red cell products transfused.

* **nplasma:** Similar to ncell, with, in fact, a median at 0, the distribution is weighted to the left and therefore many patients only need a small number of or zero units of plasma transfused. The kernel density is at zero and very tightly distributed on zero.

* **nplatelets:** Even more extreme than nplasama, the kernel density distribution is centered at 0 with only a number of values above zero for nplatelets. Clearly, most patients do not need platelets transfused. 

* **ncryo:** A very similar kernel density distribution to nplatelets, centered around 0 with only a few patients requiring cryoprecipitate transfused.

* **bvii:**  The value for bvii is 9456 for 0 and 41 for 1, showing that the vast majority of patients do not receive recombinant factor VIIa.

* **death:** Shows that most patients survive the trail with 7672 surviving in comparison to 1825 who did not.

* **bloading:** Shows the patients that receive the complete dose of the trial drug.

### Graphical visulations of quantitative variable relationships

1. **Scatterplot Matrix of quantitative variables**

```{r echo=FALSE}
#pairs(~age+injurytime+sbp+rr+cc+hr, data=X,
#      main="Quantitative Scatterplot Matrix Set 1", col=color_1)
#pairs(~age+ndaysicu+ncell+nplasma+nplatelets+ncryo, data=X,
#      main="Quantitative Scatterplot Matrix Set 2", col=color_1)
```

2. **Scatterplot Matrix of quantitative variables by sex**

```{r echo=FALSE}
#colors_sex <- c(color_3,color_2)[1*(X$sex=="Male")+1]
#pairs(~age+injurytime+sbp+rr+cc+hr, 
#      data=X, 
#      main="Quantitative Scatterplot Matrix Set 1 by Gender", 
#      col = colors_sex)

#pairs(~age+ndaysicu+ncell+nplasma+nplatelets+ncryo, 
#      data = X, 
#      main = "Quantitative Scatterplot Matrix Set 2 by Gender", 
#      col = colors_sex)
```   

We separated our quantitative variables into two sets of scatter-plot matrices as we have too many variables to do one set. It is hard to see any definite relationships between variables for any set of variables. We can see that some variables, as we discussed above, are very unbalanced, and therefore the observations are concentrated in specific regions of the scatter-plot like for the plots of *ncryo*, *nplatelets*, and more. Other distributions, almost appear as "shotgun" distributions with no distinct grouping such as those for age in relation to *sbp*, *rr*, *cc*, and hr as well as for hr and other variables, for example. These relationships are sensible for more balanced distributions as they are not weighted or skewed in a certain area of the plot. We do not see any remarkable difference in terms of sex.

3. **Andrews plot**

```{r echo=FALSE}
#X_quan <- X[,c(3,4,6,7,8,9,10,12,13,14,15)]
#andrews(as.data.frame(cbind(X_quan,as.factor(X[,1]))),
#        clr=8,
#        ymax=4,
#        main="Andrews' Plot in terms of Sex")
```

Andrew's plot agrees with our observation above. We do see a difference in the distributions of sex in the Andrews' plot, but not very substantially.

